<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
</head>
<body>
    <canvas id="canvas" width="300" height="300"></canvas>
    <script src="fabric.js"></script>

    <script>
      var canvas = new fabric.Canvas('canvas');

      function animate_commet(N, base_size, dist, minx, miny, maxx, maxy, duration) {
        animate_commet_particle(0, N, base_size, dist, minx, miny, maxx, maxy, duration);
      }
 
      function animate_commet_particle(n, N, base_size, dist, minx, miny, maxx, maxy, duration) {
        if(n == N) {
          return;
        }

        var rel = 1 - n / N;
        var rect = new fabric.Circle({
          top : 0,
          left : 0,
          radius : rel *  base_size,
          fill : 'red',
          opacity : rel,
        });
        animate(rect, minx, miny, maxx, maxy, duration);

        setTimeout(function() { animate_commet_particle(n + 1, N, base_size, dist, minx, miny, maxx, maxy, duration); }, dist);
      }
 
      function animate(rect, minx, miny, maxx, maxy, duration) {
        canvas.add(rect);
        animate_one(rect, 'top', miny, maxy, duration);
        animate_one(rect, 'left', minx, maxx, duration);

        setTimeout(function() { rect.setOpacity(0); canvas.add(rect); }, duration + 70);
      }

      function animate_one(element, direction, min, max, duration) {
        element.set(direction, min);
        canvas.add(element);
        element.animate(direction, max, { 
          duration: duration,
          onChange: canvas.renderAll.bind(canvas),
        });
      }

      var x0 = 20;
      var y0 = 20;
      var x1 = 250;
      var y1 = 250;
      var length = 500;

      //animate(x0, y0, x1, y1, length);
      animate_commet(5, 5, 0, x0, y0, x1, y1, length);
    </script>
</body>
</html>
